\usepackage{fontspec}
\setmainfont{Linux Libertine O}
\setsansfont{Droid Sans}
\setmonofont{CMU Typewriter Text}

% \usepackage{geometry}
\usepackage[showframe]{geometry}
% \geometry{left=2.54cm, right=2.54cm, top=3.18cm, bottom=3.18cm}

% 应在 geometry 之后引入 不然页眉线不撑满整个宽度
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LO]{\color{red}\nouppercase\rightmark}
\fancyhead[LE,RO]{\color{red}\thepage}
\fancyhead[RE]{\color{red}\nouppercase\leftmark}
\renewcommand{\headrulewidth}{0.6pt}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter:#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}

\usepackage{indentfirst}

\usepackage{titlesec}
\titleformat{\chapter}{\color{red}\LARGE\bfseries\centering}{\thechapter :}{.5em}{}[\vspace*{1em}\titlerule]
\titleformat{\section}{\color{red}\Large\bfseries}{}{0pt}{}
\titleformat{\subsection}{\color{red}\large\bfseries}{}{0pt}{}

\usepackage{titletoc}
\titlecontents{section}[2em]{\addvspace{2pt}\filright}{}{}{\titlerule*[8pt]{.}\contentspage}
\titlecontents{subsection}[4em]{\addvspace{2pt}\filright}{}{}{\titlerule*[8pt]{.}\contentspage}

\usepackage{xpatch}
\xpretocmd\headrule{\color{red}}{}{\PatchFailed}

\usepackage{xurl}
% make te text hyphenat
\usepackage[htt]{hyphenat}
\usepackage{xcolor}
\definecolor{lightgray}{rgb}{.9, .9, .9}

\usepackage{enumitem}
\setlist[itemize]{font=\ttfamily, itemsep=0pt, parsep=0pt}

\usepackage{float}
\usepackage{caption}
\captionsetup{font={large, bf}, labelformat=empty, justification=centering}

\usepackage{tikz}
\usepackage{graphicx}
\usepackage[all,pdf,color]{xy}
\usepackage{rotating}
\usepackage{float}

\usepackage{makeidx}
\makeindex

\usepackage{hyperref}
\hypersetup{
  bookmarksnumbered,
  colorlinks
}

\usepackage[framemethod=TikZ]{mdframed}
\mdfsetup{
  linecolor=purple!50!black,
  backgroundcolor=lightgray,
  shadow,
  innertopmargin=0pt,
  innerbottommargin=0pt,
  innerleftmargin=2pt,
}

\usepackage[cachedir=../_minted-main]{minted}
% xleftmargin=20pt
\setminted[typescript]{
  fontsize=\small,
  breaklines,
  linenos,
  escapeinside=\%\%,
  % 使用 mdframed 代替
  % bgcolor=lightgray,
  % frame=single,
  % rulecolor=purple!50!black,
}
\usemintedstyle{perldoc}
\renewcommand{\theFancyVerbLine}{\ttfamily
  \textcolor[rgb]{0.5,0.5,1.0}{\small
    \oldstylenums{\arabic{FancyVerbLine}}}}

% https://tex.stackexchange.com/questions/228058/how-to-space-before-and-after-a-minted-code-block-with-bgcolor
\usepackage{etoolbox}
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\vspace{0pt}\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\vspace{0pt}}{}{}
\makeatother

% \BeforeBeginEnvironment{minted}{\begin{mdframed}}
% \AfterEndEnvironment{minted}{\end{mdframed}}
\surroundwithmdframed{minted}

\newcommand\step[1]{\setlength\fboxsep{1.5pt}\colorbox{black}{\textcolor{white}{#1}}}
\newcommand\ts[1]{\mintinline{ts}{#1}}
